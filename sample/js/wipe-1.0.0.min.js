/*!wipe-hyl 1.0.0 发布日期:2018-11-19*/
function Wipe(t){this.cas=document.querySelector("#"+t.id),this.conId=t.id,this.context=this.cas.getContext("2d"),this.moveX=0,this.moveY=0,this.isMouseDown=!1,this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),this.cas.width=t.width,this.cas.height=t.height,this.backImgUrl=t.backImgUrl,this.imgUrl=t.imgUrl,this.coverType=t.coverType,this.color=t.color||"#666",this._w=t.width||this.cas.width,this._h=t.height||this.cas.height,this.radius=t.radius||20,this.percent=t.percent||50,this.callback=t.callback,this.backImg(),this.drawMask(),this.addEvent()}Wipe.prototype.drawT=function(t,e,i,o){if(2===arguments.length)this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.radius,0,2*Math.PI),this.context.fillStyle="rgb(250,0,0)",this.context.fill(),this.context.restore();else{if(4!==arguments.length)return!1;this.context.save(),this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,o),this.context.lineWidth=2*this.radius,this.context.stroke(),this.context.restore()}},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getTransparencyPercent=function(){var t=0,e=this.context.getImageData(0,0,this._w,this._h);for(i=0;i<this._h;i++)for(j=0;j<this._w;j++){var o=4*(this._w*i+j)+3;0===e.data[o]&&t++}return this.percent=t/(this._w*this._h)*100,console.log(Math.ceil(this.percent)+"%"),this.percent.toFixed(2)},Wipe.prototype.drawMask=function(){if("color"===this.coverType||""===this.coverType)this.context.fillStyle=this.color,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out";else if("image"===this.coverType){var t=this,e=new Image;e.src=this.imgUrl,e.onload=function(){t.context.drawImage(e,0,0,t._w,t._h),t.context.globalCompositeOperation="destination-out"}}},Wipe.prototype.addEvent=function(){var s,c,i,n,h,t=this.device?"touchstart":"mousedown",e=this.device?"touchmove":"mousemove",o=this.device?"touchend":"mouseup",r=this;this.cas.addEventListener(t,function(t){for(s=r.cas.offsetLeft,c=r.cas.offsetTop,i=r.cas;i=i.offsetParent;)s+=i.offsetLeft,c+=i.offsetTop;n=document.documentElement.scrollTop||document.body.scrollTop,h=document.documentElement.scrollLeft||document.body.scrollLeft;var e=t||window.event;r.moveX=r.device?e.touches[0].clientX-s+h:e.clientX-s+h,r.moveY=r.device?e.touches[0].clientY-c+n:e.clientY-c+n,r.drawT(r.moveX,r.moveY),r.isMouseDown=!0}),this.cas.addEventListener(e,function(t){if(n=document.documentElement.scrollTop||document.body.scrollTop,h=document.documentElement.scrollLeft||document.body.scrollLeft,!r.isMouseDown)return!1;var e=t||window.event;e.preventDefault();var i=r.device?e.touches[0].clientX-s+h:e.clientX-s+h,o=r.device?e.touches[0].clientY-c+n:e.clientY-c+n;r.drawT(r.moveX,r.moveY,i,o),r.moveX=i,r.moveY=o},!1),this.cas.addEventListener(o,function(t){r.isMouseDown=!1;var e=r.getTransparencyPercent();r.callback.call(null,e),50<e&&(alert("超过了50%的面积"),r.clearRect())},!1)},Wipe.prototype.backImg=function(){this.cas.style.cssText="background:url("+this.backImgUrl+") center 0 no-repeat; background-size: cover;"};